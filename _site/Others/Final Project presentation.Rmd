---
title: "Final Project"
author: "Cristina"
date: "April 30, 2017"
output: ioslides_presentation
---

```{r setup, include=FALSE}
setwd("C:/Users/crish/OneDrive/Documents/Columbia SIPA/2017 Spring/Data Visualization/Final Project/")

library(readr)
jme <- readstata13::read.dta13("data/JME_2016.dta")
disparities <- readstata13::read.dta13("data/stunting disparities.dta")
```

##Malnutrition estimates

Malnutrition around the world is measured with...

- Stunting
- Wasting 

##Malnutrition estimates
```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(ggthemes)
library(scales)

jme2014 <- jme[which(jme$year=='2014'),]

ggplot(subset(jme2014), aes(x=region, y=num_wasting, fill=region)) + geom_bar(stat = "identity") + 
         scale_fill_brewer(palette="YlGnBu") + 
  ggtitle("Graph 1. Number of children wasted, 2014") + 
  labs(x="", y = "Children wasted", size=8) +
  theme_classic(base_size = 12) + theme(text = element_text(color = "gray20"),
                                        axis.text.x = element_text(NULL),
          legend.position = c("none"),
          axis.text = element_text(face = "italic"),
          axis.title.x = element_text(vjust = -1),
          axis.title.y = element_text(vjust = 2),
          axis.ticks.y = element_blank(),
          axis.line = element_line(color = "gray40", size = 0.5),
          axis.line.y = element_blank(),
          panel.grid.major = element_line(color = "gray50", size = 0.5),
          panel.grid.major.x = element_blank(),
          plot.margin = margin(t = 0, r = 0, b = 40, l = 5, unit = "pt"),
          plot.title = element_text(face = "bold", color = "black", size = 11, hjust=0.5))
```


##Across time...

```{r, echo=FALSE, warning=FALSE, message=FALSE}

jmeyears <- jme[which(jme$year=='2000' | jme$year=='2006' | jme$year=='2010' | jme$year=='2014'),]

ggplot(data=jmeyears, aes(x=year, y=num_wasting, fill=year)) + geom_bar(stat = "identity") + 
         scale_fill_brewer(palette="YlGnBu") + 
  ggtitle("Graph 1. Number of children wasted, 2014") + 
  labs(x="", y = "Number of children wasted", size=8) +
  theme_classic(base_size = 12) + theme(text = element_text(color = "gray20"),
                                        axis.text.x = element_text(NULL),
          legend.position = c("none"), 
          axis.text = element_text(face = "italic"),
          axis.title.x = element_text(vjust = -1),
          axis.title.y = element_text(vjust = 2),
          axis.ticks.y = element_blank(),
          axis.line = element_line(color = "gray40", size = 0.5),
          axis.line.y = element_blank(),
          panel.grid.major = element_line(color = "gray50", size = 0.5),
          panel.grid.major.x = element_blank(),
          plot.margin = margin(t = 0, r = 0, b = 40, l = 5, unit = "pt"),
          plot.title = element_text(face = "bold", color = "black", size = 11, hjust=0.5))
```


##Stunting

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(ggthemes)
library(scales)

jme2014 <- jme[which(jme$year=='2006' | jme$year=='2014'),]

ggplot(jme2014, aes(x=year, y=stunting)) + 
  geom_boxplot() +
  geom_jitter(size = 4, alpha = 0.5, aes(col = region, size=year), na.rm = TRUE)  + facet_grid(. ~ region) +
  ggtitle("Graph 1. Percentage of stunting per region, 2006-2014") + 
  labs(x="", y = "Stunting (%)", size=8) +
  #scale_color_manual(name = "", values = c("#76881D", "#FFC72C", "#D40F7D", "#9B2242",
  #                                         "#F2583F", "#96503F", "#96443F"))
  ggthemes::theme_few(base_size = 12) + theme(text = element_text(color = "gray20"),
                                        axis.text.x = element_text(NULL),
          legend.position = c("none"), 
          axis.text = element_text(face = "italic"),
          axis.title.x = element_text(vjust = -1),
          axis.title.y = element_text(vjust = 2),
          axis.ticks.y = element_blank(),
          axis.line = element_line(color = "gray40", size = 0.5),
          axis.line.y = element_blank(),
          panel.grid.major = element_line(color = "gray50", size = 0.5),
          panel.grid.major.x = element_blank(),
          plot.margin = margin(t = 0, r = 0, b = 40, l = 5, unit = "pt"),
          plot.title = element_text(face = "bold", color = "black", size = 11, hjust=0.5))
```


##wasting

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(ggthemes)
library(scales)

jme2014 <- jme[which(jme$year=='2006' | jme$year=='2014'),]

ggplot(jme2014, aes(x=year, y=wasting)) + 
  geom_boxplot() +
  geom_jitter(size = 4, alpha = 0.5, aes(col = region, size=year), na.rm = TRUE)  + facet_grid(. ~ region) +
  ggtitle("Graph 1. Percentage of wasting per region, 2006-2014") + 
  labs(x="", y = "Wasting (%)", size=8) +
  #scale_color_manual(name = "", values = c("#76881D", "#FFC72C", "#D40F7D", "#9B2242",
  #                                         "#F2583F", "#96503F", "#96443F"))
  ggthemes::theme_few(base_size = 12) + theme(text = element_text(color = "gray20"),
                                        axis.text.x = element_text(NULL),
          legend.position = c("none"), 
          axis.text = element_text(face = "italic"),
          axis.title.x = element_text(vjust = -1),
          axis.title.y = element_text(vjust = 2),
          axis.ticks.y = element_blank(),
          axis.line = element_line(color = "gray40", size = 0.5),
          axis.line.y = element_blank(),
          panel.grid.major = element_line(color = "gray50", size = 0.5),
          panel.grid.major.x = element_blank(),
          plot.margin = margin(t = 0, r = 0, b = 40, l = 5, unit = "pt"),
          plot.title = element_text(face = "bold", color = "black", size = 11, hjust=0.5))
```



##Tablas...
```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width=3, fig.align='center'}

myvars <- c("country", "region", "year", "wasting", "stunting", "pop5")
jme_short <- jmeyears[myvars]

#install.packages("DT")
library(DT)
datatable(jme_short, 
          colnames = c('Country', 'Region', 'Year', 'Wasting (%)', 
                       'Stunting (%)', 'Children < 5 years old (000)'), 
          filter = 'top', options = list(pageLength = 10, autoWidth = TRUE),
          caption = 'Table 1: Wasting and Stunting levels, 2000-2014')
```

Pegamos los datos...

```{r, include=FALSE}
library(raster)
world_spdf <- shapefile("data/world_map/TM_WORLD_BORDERS_SIMPL-0.3.shp")

# Merge the QoG data to Shape Files
library(dplyr)
mapdisparities <- world_spdf@data %>% left_join(disparities, by = c(ISO3 = "iso"))
world_spdf@data <- mapdisparities

```


#Mapas con plotly...

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(leaflet)
leaflet(world_spdf) %>% 
  addProviderTiles("Esri.WorldGrayCanvas")  %>% 
  setView(lat=34.612255, lng=-22.300443 , zoom=10) %>%
    # Base groups = Background layer
    addTiles(group = "OpenStreetMap") %>%
    addProviderTiles(providers$Stamen.TonerLite, group = "Toner Lite") %>%
    addProviderTiles(providers$Stamen.Toner, group = "Toner")  %>%
    
    # Data Layers
      # First Data Layer: Stunting 20% poorer
    addPolygons(group="Stunting 1st wealth quintile",
                stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5, 
                color = ~colorNumeric("Spectral", wq1)(wq1),
                popup = paste("Country:",world_spdf$NAME,"<br/>",
                              "Stunting in 1st quintile:", world_spdf$wq1,"%","<br/>")) %>%
    #Add legends
    #addLegend("bottomright", pal = colorNumeric("Spectral", world_spdf$wq1), 
     #         values = ~wq1, title = "% Stunting 1st WQ", opacity = 0.5) %>%
     
    # Second Data Layer: College
    addPolygons(group="Stunting 5th wealth quintile", data=world_spdf,
                stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5, 
                color = ~colorNumeric("Spectral", wq5)(wq5),
                popup = paste("Country:",world_spdf$NAME,"<br/>",
                              "Stunting in 5th quintile:", world_spdf$wq5,"%","<br/>")) %>%
    #Add legends
    addLegend("bottomright", pal = colorNumeric("Spectral", world_spdf$wq5), 
              values = ~wq5, title = "% Stunting 5th WQ", opacity = 0.5) %>%
  
    # Layers control
    addLayersControl(
    baseGroups = c("OpenStreetMap", "Toner", "Toner Lite"),
    overlayGroups = c("Stunting 1st wealth quintile","Stunting 5th wealth quintile"),
    options = layersControlOptions(collapsed = TRUE) )
```

